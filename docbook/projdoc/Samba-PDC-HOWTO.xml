<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="samba-pdc">

<chapterinfo>
	&author.jht;
	&author.jerry;
	&author.dbannon;
	<author>&person.gd; <contrib>LDAP updates</contrib></author>
	<author>&author.sgw;<contrib>German Translator</contrib></author>
</chapterinfo>

<title>Die Kontrolle über eine Domäne</title>

<para>
Viele nähern sich der Thematik der MS-Windows-Netzwerke mit falschen Vorstellungen.
Das ist ok so, weil es uns anderen viele Möglichkeiten dazu gibt, Hilfe zu geben.
Diejenigen, die wirklich helfen wollen, sind gut beraten, sich mit der bereits vorhandenen Information und Dokumentation vertraut zu machen.
</para>

<para>
Der Leser ist gut beraten, diesen Abschnitt der Samba-Dokumentation gar nicht erst anzugehen, solange er nicht einige Grundlagen beherrscht. MS-Windows-Netzwerke sind nicht gerade tolerant gegenüber Fehl-Konfigurationen. Anwender von MS-Windows-Netzwerken beschweren sich oft über dauernde Unannehmlichkeiten infolge "kaputter" Netzwerk-Konfigurationen.
Für viele jedoch beginnt die Arbeit mit MS-Windows-Netzwerken mit einem Domänen-Controller, von dem erwartet wird, daß er auf irgendeine magische Art alle Netzwerk-Probleme lösen wird.
</para>

<para>
Das Diagramm in <link linkend="domain-example"/> zeigt eine klassische Umgebung unter Verwendung einer MS-Windows-Sicherheits-Domäne (MS Windows Domain Security network environment). Die Workstations A, B und C repräsentieren eine Vielzahl physischer MS-Windows-Netzwerk-Clients.
</para>

<figure id="domain-example"><title>Eine Beispiel-Domäne.</title>
<mediaobject>
<imageobject role="latex"><imagedata fileref="projdoc/imagefiles/domain" width="4in" height="3in" scalefit="1"/></imageobject>
<imageobject><imagedata fileref="projdoc/imagefiles/domain.png" scale="50" scalefit="1"/></imageobject>
</mediaobject>
</figure>


<?latex \newpage ?>

<para>
In der Samba mailing list kann man leicht viele weit verbreitete Netzwerk-Themen erkennen.
Wenn Sie mit den folgenden Themen nicht vertraut sind, wird es helfen, die entsprechenden Abschnitte dieses HOWTOs zu lesen. Dies sind die häufigsten Ursachen für Probleme mit MS-Windows-Netzwerken:
</para>

<itemizedlist>
	<listitem><para>Grundlegende TCP/IP-Konfiguration.</para></listitem>
	<listitem><para>NetBIOS Namens-Auflösung.</para></listitem>
	<listitem><para>Authentifizierungs-Konfiguration.</para></listitem>
	<listitem><para>Benutzer- und Gruppen-Konfiguration.</para></listitem>
	<listitem><para>Grundlegende Datei- und Verzeichnis-Rechte in UNIX/Linux.</para></listitem>
	<listitem><para>Verstehen wie MS-Windows-Clients in einer Netzwerkumgebung zusammenarbeiten.</para></listitem>
</itemizedlist>

<para>
Lassen Sie sich nicht abschrecken; an der Oberfläche erscheint ein MS-Windows-Netzwerk so simpel, daß es jeder schafft. Tatsächlich ist es aber keine gute Idee, ein MS-Windows-Netzwerk ohne entsprechende Übung und Vorbereitung aufzusetzen. Aber lassen Sie uns unser erstes unauslöschliches Prinzip aus dem Weg räumen:
<emphasis>Es ist in Ordnung, Fehler zu machen!</emphasis>
Am richtigen Ort, zur richtigen Zeit, sind Fehler die Essenz des Lernens. Es ist jedoch ganz und gar nicht in Ordnung, Fehler zu machen, die Produktivitäts-Einbussen verursachen und einer Organisation einen vermeidbaren finanziellen Verlust zufügen.
</para>

<para>
Wo ist der rechte Ort für Fehler? Nur dort, wo kein Schaden entstehen kann. Wenn Sie Fehler machen wollen, dann machen Sie diese bitte in einer Test-Umgebung, abseits von anderen Benutzern, auf eine Art, die anderen keine Probleme macht.
Lernen Sie in einem Test-Netzwerk.
</para>

<sect1>
<title>Eigenschaften und Nutzen</title>

<para>
<indexterm><primary>Domänen-Sicherheit</primary></indexterm>
<emphasis>Was ist der Hauptnutzen von Microsoft-Domänen-Sicherheit ?</emphasis>
</para>

<para>
In einem Wort, <emphasis>Single Sign On</emphasis>, oder noch kürzer SSO.
Für viele ist dies der "Heilige Gral" des Windows-NT-Netzwerks und darüber hinaus. SSO erlaubt Benutzern eines gut angelegten Netzwerks, sich auf jeder Workstation anzumelden, die Mitglied jener Domäne ist, zu der ihr Benutzer-Konto gehört (bzw. auf einer Workstation, die Mitglied einer Domäne ist, die ein geeignetes Vertrauensverhältnis zur eigenen Domäne hat). Dadurch können sie sich am Netzwerk anmelden und auf dessen Resourcen zugreifen (Freigaben, Dateien und Drucker) als ob sie an ihrem Stamm-Rechner sitzen würden. Dies ist ein Merkmal des Domänen-Sicherheits-Protokolls.
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
Die Vorzüge von Domänen-Sicherheit eröffnen sich jenen, die einen Samba-PDC verwenden.
Eine Domäne stellt einen eindeutigen Netzwerk-Sicherheits-Identifizierungs-Schlüssel (network security identifier), kurz SID, zur Verfügung. Domänen-Benutzer- und -Gruppen-Sicherheits-Identifizierungs-Schlüssel umfassen den SID plus einem relativen Identifizierungs-Schlüssel (RID), der sich eindeutig auf das jeweilige Konto bezieht.
Benutzer- und Gruppen-SIDs (Netzwerk-SID plus RID) können dazu verwendet werden, sogenannte Zugriffs-Kontroll-Listen, besser bekannt als ACLs (Access Control Lists) zu erstellen, die, bezogen auf einzelne Netzwerk-Resourcen, organisationsweite Zugriffs-Kontrolle ermöglichen. UNIX-Systeme erkennen nur lokale SIDs.
</para>

<note><para>
Netzwerk-Clients einer MS-Windows-Sicherheits-Domänen-Umgebung müssen Domänen-Mitglieder sein, um Zugriff auf die erweiterten Funktionalitäten zu erlangen. Domänen-Mitgliedschaft beinhaltet mehr als das Setzen des Arbeitsgruppen-Namens auf den Domänen-Namen. Sie erfordert das Anlegen eines Domänen-Kontos für die Workstation (genannt Maschinen-Konto). Sehen Sie <link linkend="domain-member"></link> für mehr Informationen dazu.
</para></note>

<para>
Die folgenden Funktionalitäten sind in der Release Samba 3 neu:
</para>

<itemizedlist>
	<listitem><para>
	Windows NT4 Vertrauens-Domänen.
	</para></listitem>

	<listitem><para>
	<indexterm><primary>Nexus.exe</primary></indexterm>
	Das Hinzufügen von Benutzern via "User Manager for Domains". Dies kann von jedem MS-Windows-Client mittels dem <filename>Nexus.exe</filename> toolkit für Windows 9x/Me, oder mittels dem SRVTOOLS.EXE-Paket für MS Windows NT4/200x/XP-Plattformen durchgeführt werden. Diese Pakete sind auf der Microsoft-Website verfügbar.
	</para></listitem>

	<listitem><para>
	Die Einführung mehrerer austauschbarer Benutzer-Konten-Backends (Authentifizierungs-Backends).
	Im Falle der Verwendung von LDAP als Backend profitiert Samba-3 von den Vorzügen eines Backends, das verteilt und repliziert werden kann, sowie hochgradig skalierbar ist.
	</para></listitem>

	<listitem><para>
	Die Einführung voller Unicode-Unterstützung.
	Dies vereinfacht die Unterstützung internationaler locales. Es eröffnet weiters die Verwendung von Protokollen, die Samba-2.2.x bereits unterstützte, jedoch mangels voller Unicode-Unterstützung nicht verwenden konnte.
	</para></listitem>
</itemizedlist>

<para>
Die folgenden Funktionalitäten werden von Samba-3 NICHT zur Verfügung gestellt:
</para>
<itemizedlist>
	<listitem><para>
<indexterm><primary>SAM</primary></indexterm>
<indexterm><primary>Replikation</primary></indexterm>
	SAM-Replikation mit MS-Windows-NT4-Domänen-Controllern
	(z.B., ein Samba PDC und ein Windows NT BDC oder vice versa).

	Dies bedeutet, daß Samba NICHT als BDC arbeiten kann, wenn der PDC Microsoft-basiert ist.
	Weiters bedeutet es, daß Samba Kontodaten NICHT auf MS-BDCs replizieren.
	</para></listitem>

	<listitem><para>
	Das Arbeiten als Windows 2000 Domain Controller
	(z.B., Kerberos und Active Directory).

	Tatsächlich hat Samba-3 einige AD-Domänen-Kontroll-Fähigkeiten, die zum jetzigen Zeitpunkt rein experimenteller Natur sind. Diese werden sicherlich zu voll unterstützten Features ausgebaut, sei es während der Existenz von Samba-3 oder zu einem späteren Zeitpunkt. Wie dem auch sei, Active Directory ist mehr als nur SMB &smbmdash;, es ist weiters LDAP, Kerberos, DHCP, und andere Protokolle (selbstverständlich mit proprietären Erweiterungen).
	</para></listitem>

	<listitem><para>
	Die Windows 200x/XP MMC (Computer Management) Console kann NICHT zum Betrieb eines Samba-3 Servers verwendet werden.
	Dazu können nur der MS Windows NT4 Domain Server Manager und der MS Windows NT4 Domain User Manager verwendet werden. Beide sind Bestandteil des später erwähnten SVRTOOLS.EXE-Pakets.
	</para></listitem>
</itemizedlist>

<para>
Windows 9x/Me/XP Home-Clients sind keine vollwertigen Domänen-Mitglieder, aus den hier erwähnten Gründen. Das Protokoll zur Unterstützung von Windows 9x/Me-Netzwerk(-Domänen)-logons unterscheidet sich völlig von dem zur Unterstützung von NT4/Windows 200x-Netzwerk(-Domänen)-logons und wurde einige Zeit offiziell unterstützt. Diese Clients verwenden die alten LanMan-Netzwerk-Logon-Mechanismen, die in Samba ungefähr seit Serie Samba-1.9.15 unterstützt werden.
</para>

<para>
Samba-3 implementiert die Zuweisung von Gruppen zwischen Windows-NT-Gruppen und UNIX-Gruppen (dies ist wirklich sehr schwierig in kurzen Worten zu erklären). Dies wird umfassender in <link linkend="groupmapping"></link> behandelt.
</para>

<para>
<indexterm><primary>Maschinen-Vertrauens-Konten</primary></indexterm>
Samba-3 muß (wie ein MS Windows NT4 PDC oder ein Windows 200x AD) Benutzer- und Maschinen-Vertrauens-Konten in einem passenden Daten-Backend ablegen. Siehe <link linkend="machine-trust-accounts"></link>. Mit Samba-3 können dazu mehrere Backends verwendet werden. Eine vollständige Diskussion von Konten-Datenbank-Backends finden Sie in <link linkend="passdb"></link>.
</para>

</sect1>

<sect1>
<title>Grundlagen der Domänen-Verwaltung</title>

<para>
Im Laufe der Jahre hat die allgemeine Auffassung von Domänen-Verwaltung eine fast schon mystische Gestalt angenommen. Bevor wir zu einem kurzen Überblick über Domänen-Verwaltung verzweigen, beschreiben wir die drei grundsätzlichen Typen von Domänen-Controllern.
</para>

<sect2>
<title>Typen von Domänen-Controllern</title>

<itemizedlist>
	<listitem><para>Primary Domain Controller</para></listitem>
	<listitem><para>Backup Domain Controller</para></listitem>
	<listitem><para>ADS Domain Controller</para></listitem>
</itemizedlist>

<para>
Der <emphasis>Primary Domain Controller</emphasis> oder PDC spielt eine wichtige Rolle in MS Windows NT4. In der Windows 200x-Domänenverwaltungs-Architektur wird diese Rolle von Domänen-Controllern übernommen. Die "Folklore" schreibt vor, daß dies wegen seiner Rolle im MS Windows Netzwerk der stärkste und schnellste Rechner im Netz sein sollte. So seltsam das an dieser Stelle klingen mag, der Wunsch nach guter allgemeiner Netzwerk-Performance erfordert zwingend, daß die gesamte Infrastruktur ausgewogen gestaltet wird. Es ist ratsam, mehr in Stand-alone(Domänen-Mitglieds-)-Server zu investieren als in die DCs.
</para>

<para>
<indexterm><primary>SAM</primary></indexterm>
Im Falle von MS Windows NT4-Domänen ist es der PDC, der eine neue Domänen-Verwaltungs-Datenbank initiiert. Diese bildet einen Teil der Windows-Registrierung namens Security Account Manager (SAM). Sie spielt eine Schlüsselrolle in NT4-artiger Domänen-Benutzer-Authentifizierung und in der Synchronisation der Domänen-Authentifizierungs-Datenbank mit Backup-Domänen-Controllern.
</para>

<para>
In MS Windows 200x-Server-basierten Active-Directory-Domänen initiiert ein Domänen-Controller eine mögliche Hierarchie von Domänen-Controllern, von denen jeder seinen eigenen delegierten Verwaltungsbereich erhält. Der Master-Domänen-Controller hat die Möglichkeit, jeden "downstream controller" zu übergehen, jedoch hat ein "downline controller" nur Kontrolle über seine "downline" (WEICHINGER: Wie übersetzen?) Mit Samba-3 kann diese Funktionalität durch Verwendung eines Konten-Backends auf LDAP-Basis implementiert werden.
</para>

<para>
Neu in Samba-3 ist die mögliche Verwendung einer Backend-Datenbank, die dieselben Daten enthält wie eine NT4-artige SAM-Datenbank (eines der Registrierungs-files)<footnote>Siehe auch <link linkend="passdb"/>.</footnote>.
</para>

<para>

Der <emphasis>Backup Domain Controller</emphasis> oder BDC spielt eine Schlüsselrolle in der Beantwortung von Netzwerk-Authentifizierungs-Anfragen. Der BDC ist darauf ausgerichtet, logon-Anfragen vor dem PDC zu beantworten. In einem Netzwerk-Segment, das sowohl einen BDC wie auch einen PDC beinhaltet, wird der BDC meist die Netzwerk-logon-Anfragen bedienen. Der PDC wird diese dann beantworten, wenn der BDC überlastet ist. EIn BDC kann zum PDC ernannt werden. Wenn der PDC online ist, wenn der BDC zum PDC ernannt wird, wird der vorige PDC automatisch zum BDC zurückgestuft. Mit Samba-3 ist dieser Vorgang nicht automatisch; der PDC und der BDC müssen händisch konfiguriert werden.
</para>

<para>
Bei der Installation von NT 4 wird die Entscheidung darüber getroffen, welcher Art von Maschine der Server angehören soll. Es ist möglich, einen BDC zu einem PDC zu ernennen und umgekehrt. Die einzige Möglichkeit, einen DC in einen Domänen-Mitglieds-Server oder einen Stand-Alone-Server umzuwandeln, ist, ihn neu zu installieren.

Die Wahlmöglichkeiten bei der Installation sind:
</para>

<itemizedlist>
	<listitem><para><emphasis>Primärer Domänen-Controller / PDC </emphasis> &smbmdash; der Server, der die Domänen-SAM begründet.</para></listitem>
	<listitem><para><emphasis>Backup Domänen-Controller / BDC </emphasis> &smbmdash; ein Server, der eine Kopieder Domänen-SAM anlegt.</para></listitem>
	<listitem><para><emphasis>Domänen-Mitglieds-Server</emphasis> &smbmdash;  ein Server, der keine Kopie der Domänen-SAM hält, jedoch seine Authentifizierungsinformationen von einem Domänen-Controller bezieht.</para></listitem>
	<listitem><para><emphasis>Stand-alone Server</emphasis> &smbmdash;  ein Server, der keine Rolle in der Sysnchronisation der Domänen-SAM spielt, seine eigene Authentifizierungs-Datenbank führt und auch keine Rolle in der Domänen-Sicherheit übernimmt.</para></listitem>
</itemizedlist>

<para>
Bei der Verwendung von MS Windows 2000 wird die Konfiguration der Domänen-Verwaltung nach der Installation des Servers vorgenommen. Samba-3 kann als vollwertiges Mitglied einer Windows-200x-Server-Active-Directory-Domäne arbeiten.
</para>

<para>
<indexterm><primary>Replikation</primary><secondary>SAM</secondary></indexterm>
Neu in Samba-3 ist die Fähigkeit, als vollwertiger MS-Windows-NT4-Domänen-Controller zu arbeiten, ausgenommen die SAM-Replikations-Komponenten. Bitte beachten Sie, daß Samba-3 auch die MS Windows 200x Domänen-Verwaltungs-Protokolle unterstützt.
</para>

<para>
Zum jetzigen Zeitpunkt ist jegliches Anzeichen dafür, daß Samba-3 als <emphasis>Domänen Controller</emphasis> im nativen ADS-Modus arbeiten kann, begrenzt und völlig experimentell. Diese Funktionalität sollte nicht verwendet werden, bis das Samba-Team formal die Unterstützung dafür anbietet. Sobald dies erfolgt, wird die Dokumentation revidiert werden, um alle Konfigurations- und Verwaltungs-Erfordernisse vollständig widerzuspiegeln. Samba kann als NT4-DC in einem Windows 2000/XP-Umgebung arbeiten. Jedoch gibt es einige Kompromisse:

<itemizedlist>
	<listitem>Keine Maschinen-Policy-Dateien.</listitem>
	<listitem>Keine Gruppen-Policy-Objekte.</listitem>
	<listitem>Keine synchron ausgeführten AD-logon-Skripts.</listitem>
	<listitem>Active Directory management tools können nicht zur Benutzer- und Maschinen-Verwaltung verwendet werden.</listitem>
	<listitem>Registrierungs-Änderungen prägen die Haupt-Registrierung, während mit AD keine bleibenden Veränderungen hinterlassen werden.</listitem>
	<listitem>Ohne AD kann die Funktion, spezifische Applikationen für spezifische Benutzer/Gruppen zu exportieren, NICHT genutzt werden.</listitem>
</itemizedlist>
</para>

</sect2>

<sect2>
<title>Vorbereitungen für Domänen-Verwaltung</title>

<para>
Es gibt zwei Arten, auf die MS Windows-Maschinen miteinander, mit anderen Servern und DCs zusammenarbeiten können: entweder als <emphasis>Stand-alone</emphasis>-Systeme, gebräuchlich bezeichnet als <emphasis>Workgroup</emphasis>-Mitglieder, oder als vollwertige Teilnehmer eines Sicherheits-Systems, gebräuchlich bezeichnet als <emphasis>Domain</emphasis>-Mitglieder.
</para>

<para>
Es sollte beachtet werden, daß <emphasis>Workgroup</emphasis>-Mitgliedschaft keine spezielle Konfiguration erfordert, außer daß die Maschine so konfiguriert wird, daß die Netzwerk-Konfiguration einen gebräuchlichen Namen für den workgroup-Eintrag enthält. oft wird hiefür der Name WORKGROUP verwendet. In dieser Konfigurations-Art gibt es keine Maschinen-Vertrauens-Konten und jegliches Konzept von Mitgliedschaft ist darauf beschränkt, daß alle in der Netzwerkumgebung aufscheinenden Maschinen als logische Gruppe erscheinen. Zur Wiederholung und Klärung: <emphasis>Workgroup Modus beinhaltet keine Maschinen-Sicherheits-Konten</emphasis>.
</para>

<para>
Domänen-Mitglieds-Maschinen haben ein Maschinen-Konto in der Domänen-Konten-Datenbank. Eine spezielle Prozedur muß auf jeder Maschine ausgeführt werden, um Domänen-Mitgliedschaft zu erwirken. Diese Prozedur, welche nur vom lokalen Administrator-Konto aus erfolgen kann, legt das Domänen-Maschinen-Konto an (falls es noch nicht existiert), und initialisiert dieses Konto. Wenn der Client sich erstmals in der Domäne anmeldet, wird ein Maschinen-Passwort-Wechsel ausgelöst.
</para>

<note><para>
Wird Samba als Domänen-Controller konfiguriert, müssen alle MS Windows NT4/200x/XP Professional Clients als Domänen-Mitglieder konfiguriert werden, um den sicheren Betrieb des Netzwerks zu gewährleisten. Wenn eine Maschine nicht zum Domänen-Mitglied gemacht wird, wird sie sich wie eine Arbeitsgruppen(Standalone)-Maschine verhalten. Siehe <link linkend="domain-member"></link> für Informationen zur Domänen-Mitgliedschaft.
</para></note>

<para>
Folgendes ist nötig, um Samba-3 als einen MS Windows NT4-artigen PDC für MS-Windows-NT4/200x/XP-Clients zu konfigurieren:
</para>

<itemizedlist>
	<listitem><para>Konfiguration der Basisdienste TCP/IP und MS Windows Netzwerk.</para></listitem>
	<listitem><para>Korrekte Zuweisung der Server-Rolle (<smbconfoption><name>security</name><value>user</value></smbconfoption>).</para></listitem>
	<listitem><para>Konsistente Konfiguration der Namensauflösung <footnote><para>Siehe <link linkend="NetworkBrowsing"></link>, und
		<link linkend="integrate-ms-networks"></link>.</para></footnote>.</para></listitem>
	<listitem><para>Domänen-Logins für Windows NT4/200x/XP Professional Clients.</para></listitem>
	<listitem><para>Konfiguration von Roaming Profiles oder explizite Konfiguration, um die Verwendung lokaler Profile zu erzwingen.</para></listitem>
	<listitem><para>Konfiguration von Netzwerk/System-Policies.</para></listitem>
	<listitem><para>Hinzufügen und Verwalten von Domänen-Benutzer-Konten.</para></listitem>
	<listitem><para>Konfiguration von MS Windows Clients als Domänen-Mitglieder.</para></listitem>
</itemizedlist>

<para>
Die folgenden Voraussetzungen sind erforderlich, um MS Windows 9x/Me-Clients bedienen zu können:
</para>

<itemizedlist>
	<listitem><para>Konfiguration der Basisdienste TCP/IP und MS Windows Netzwerk.</para></listitem>
	<listitem><para>Korrekte Zuweisung der Server-Rolle (<smbconfoption><name>security</name><value>user</value></smbconfoption>).</para></listitem>
	<listitem><para>Netzwerk-Login-Konfiguration (da Windows 9x/Me/XP Home technisch gesehen keine Domänen-Mitglieder sind, nehmen sie auch nicht wirklich als solches an den Sicherheits-Aspekten von Domänen Anteil) .</para></listitem>
	<listitem><para>Konfiguration von Roaming Profiles.</para></listitem>
	<listitem><para>Konfiguration von System Policy handling.</para></listitem>
	<listitem><para>Installation des Netzwerk-Treibers <quote>Client for MS Windows Networks</quote> und dessen Konfiguration, um sich in der Domäne anzumelden.</para></listitem>
	<listitem><para>Setzen der Windows 9x/Me-Clients auf User Level Security &smbmdash; wenn es erwünscht ist, jeglichen Client-Zugriff auf Freigaben entsprechend der Domänen-Benutzern/Gruppen zu verwalten.</para></listitem>
	<listitem><para>Hinzufügen und Verwalten von Domänen-Benutzer-Konten.</para></listitem>
</itemizedlist>

<note><para>
Roaming Profiles und System/Network policies sind fortgeschrittene Netzwerk-Verwaltungs-Themen die in den Kapiteln <link linkend="ProfileMgmt"></link> und <link linkend="PolicyMgmt"></link> behandelt werden. Jedoch sind diese Themen für einen Samba-PDC nicht so entscheidend, da sie eng mit den Windows NT-Netzwerk-Konzepten zusammenhängen.
</para></note>

<para>
Ein Domänen-Controller ist ein SMB/CIFS-Server, der:
</para>

<itemizedlist>
	<listitem><para>
	sich selbst als Domänen Controller registriert und anbietet (sowohl durch
	NetBIOS broadcasts wie auch durch verschiedene Namensregistrierungen,
	entweder durch Mailslot Broadcasts über UDP broadcast, einem WINS-Server
	über UDP unicast, oder über DNS und Active Directory).	
	</para></listitem>

	<listitem><para>
	den NETLOGON-Dienst anbietet. (Dies ist tatsächlich eine Sammlung von Diensten,
	die über mehrere Protokolle laufen. Diese inkludieren den LanMan-Logon-Dienst,
	den Netlogon-Dienst, den Local-Security-Account-Dienst, und Abwandlungen dieser.)
	</para></listitem>

	<listitem><para>
	eine Freigabe namens NETLOGON anbietet.
	</para></listitem>
</itemizedlist>

<para>
Es ist ziemlich einfach, Samba so zu konfigurieren, daß er all dies zur Verfügung stellt. Jeder Samba Domain Controller muß den NETLOGON-Dienst anbieten, welcher von Samba als <smbconfoption><name>domain logons</name></smbconfoption>-Funktionalität bezeichnet wird (nach dem Parameter in der &smb.conf;-Datei). Weiters muß ein Server in einer Samba-3-Domäne sich selbst als Domain Master Browser bekanntgeben <footnote>Siehe <link linkend="NetworkBrowsing"/>.</footnote>.
Dies veranlaßt den PDC dazu, einen Domänen-spezifischen NetBIOS-Namen zu beanspruchen, der ihn als Domain Master Browser für die gegebene Domäne/Workgroup identifiziert. Lokale Master Browser in derselben Domäne/Workgroup und broadcast-isolierten Subnetzen erfragen dann eine komplette Kopie der "browse list" für das gesamte WAN. Browser Clients kontaktieren darauf ihren Lokalen Master Browser, und erhalten die "browse list" der gesamten Domäne, anstatt nur der Liste für ihr broadcast-isoliertes Subnetz.
</para>

</sect2>
</sect1>

<sect1>
<title>Domänen-Verwaltung &smbmdash; Beispiel-Konfiguration</title>

<para>
Der erste Schritt, um einen funktionierenden Samba PDC zu erstellen, ist, die nötigen Parameter in &smb.conf; zu verstehen. Ein Beispiel einer &smb.conf; für einen PDC finden Sie unter <link linkend="pdc-example"/>.
</para>

<para>
<smbconfexample id="pdc-example">
<title>smb.conf for being a PDC</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>netbios name</name><value><replaceable>BELERIAND</replaceable></value></smbconfoption>
<smbconfoption><name>workgroup</name><value><replaceable>&example.workgroup;</replaceable></value></smbconfoption>
<smbconfoption><name>passdb backend</name><value>tdbsam</value></smbconfoption>
<smbconfoption><name>os level</name><value>33</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>security</name><value>user</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>yes</value></smbconfoption>
<smbconfoption><name>logon path</name><value>\\%N\profiles\%u</value></smbconfoption>
<smbconfoption><name>logon drive</name><value>H:</value></smbconfoption>
<smbconfoption><name>logon home</name><value>\\homeserver\%u\winprofile</value></smbconfoption>
<smbconfoption><name>logon script</name><value>logon.cmd</value></smbconfoption>

<smbconfsection>[netlogon]</smbconfsection>
<smbconfoption><name>path</name><value>/var/lib/samba/netlogon</value></smbconfoption>
<smbconfoption><name>read only</name><value>yes</value></smbconfoption>
<smbconfoption><name>write list</name><value><replaceable>ntadmin</replaceable></value></smbconfoption>

<smbconfsection>[profiles]</smbconfsection>
<smbconfoption><name>path</name><value>/var/lib/samba/profiles</value></smbconfoption>
<smbconfoption><name>read only</name><value>no</value></smbconfoption>
<smbconfoption><name>create mask</name><value>0600</value></smbconfoption>
<smbconfoption><name>directory mask</name><value>0700</value></smbconfoption>
</smbconfexample>
</para>

<para>
Die grundlegenden Optionen, die in <link linkend="pdc-example"/> gezeigt werden, werden wie folgt erklärt:
</para>

<variablelist>
	<varlistentry><term>passdb backend </term>
		<listitem><para>
		Dies enthält sämtliche Information zu Benutzer- und Gruppenkonten. Akzeptable Werte für einen PDC sind: <emphasis>smbpasswd, tdbsam, and ldapsam</emphasis>. Der <quote>guest</quote>-Eintrag stellt Standard-Konten zur Verfügung und ist standard-mässig inkludiert, es besteht keine Notwendigkeit, ihn explizit hinzuzufügen.
Wo der Einsatz von Backup-Domänen-Controllern (BDCs) beabsichtigt ist, ist die einzige logische Wahl die Verwendung von LDAP, sodaß die passdb verteilt werden kann. Die tdbsam und smbpasswd-Dateien können nicht effektiv verteilt werden und sollten daher nicht verwendet werden.		
		</para>
</listitem>
	</varlistentry>
	<varlistentry><term>Domänen-Verwaltungs-Parameter </term>
		<listitem><para>
		Die Parameter <emphasis>os level, preferred master, domain master, security,
		encrypt passwords, und domain logons</emphasis> spielen eine wichtige Rolle bei der Unterstützung für Domänen-Kontrolle und Netzwerk-Anmeldung.</para>

		<para>
		Das <emphasis>os level</emphasis> muß auf einen Wert von mindestens 32 gesetzt werden. 
		Ein Domänen-Controller muß auch der Domänen-Master-Browser sein, muß auf <emphasis>user</emphasis>
		mode security gesetzt sein, muß MS-kompatibel verschlüsselte Passwörter unterstützen, und muß den Nettwerk-Anmelde-Dienst (Domänen-Anmeldungen) anbieten. Verschlüsselte Passwörter müssen aktiviert sein.
		Für mehr Details dazu, siehe <link linkend="passdb"></link>.
		</para></listitem>
	</varlistentry>
	<varlistentry><term>Umgebungs-Parameter</term>
		<listitem><para>
		Die Parameter <emphasis>logon path, logon home, logon drive, and logon script</emphasis> sind 
		Umgebungs-Einstellungen, die dabei helfen, Client-Anmeldungen zu ermöglichen, und die
		automatisierte Kontrollmechanismen zur Verfügung stellen, um Overheads im Netzwerk-Management
		zu verringern. Siehe die man-page für Informationen zu diesen Parametern.
		</para></listitem>
	</varlistentry>
	<varlistentry><term>NETLOGON-Freigabe</term>
		<listitem><para>
		Die NETLOGON-Freigabe spielt eine zentrale Rolle in der Unterstützung von Domänen-Anmeldungen
		und Domänen-Mitgliedschaft. Diese Freigabe wird von allen MS-Domänen-Controllern zur
		Verfügung gestellt. Sie wird dazu verwendet, um Anmelde-Skripts bereit zu stellen, um
		Group Policy files (wie NTConfig.POL) zu speichern, aber auch, um andere gängige
		Werkzeuge zur Verfügung zu stellen, die für den Anmelde-Vorgang gebraucht werden.
		Dies ist eine essentielle Freigabe auf einem Domänen-Controller.
		</para></listitem>
	</varlistentry>
	<varlistentry><term>PROFILE-Freigabe</term>
		<listitem><para>
		Diese Freigabe wird zur Speicherung von Benutzer-Desktop-Profilen verwendet.
		Jeder Benutzer muß ein Verzeichnis im root-Verzeichnis dieser Freigabe haben.
		Dieses Verzeichnis muß für den Benutzer Schreibrechte haben und global lesbar sein.
		Samba-3 hat ein VFS-Modul namens <quote>fake_permissions</quote>, das auf dieser
		Freigabe installiert werden kann. Das erlaubt es einem Samba-Administrator, das
		Verzeichnis read-only für jeden zu setzen. Natürlich ist dies nur sinnvoll, nachdem
		das Profil richtig erstellt wurde.
		</para></listitem>
	</varlistentry>
</variablelist>

<note><para>
Die obigen Parameter bilden einen vollständigen Satz von Parametern, der den Arbeitsmodus des Servers definiert.
Die folgenden &smb.conf;-Parameter sind die essentiell notwendigen:
</para>

<para>
<smbconfblock>
<smbconfoption><name>netbios name</name><value>BELERIAND</value></smbconfoption>
<smbconfoption><name>workgroup</name><value>&example.workgroup;</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
<smbconfoption><name>domain master</name><value>Yes</value></smbconfoption>
<smbconfoption><name>security</name><value>User</value></smbconfoption>
</smbconfblock>
</para>

<para>
Die zusätzlichen Parameter, die in der längeren Auflistung oben gezeigt werden, bedürfen einer weitergehenden Erklärung.
</para></note>

</sect1>

<sect1>
<title>Samba ADS Domänen-Verwaltung</title>

<para>
Samba-3 ist kein, und kann sich nicht verhalten wie ein Active Directory Server.
Samba-3 kann nicht wirklich wie ein Active Directory Primary Domain Controller funktionieren.
Die Protokolle für einige Funktionalitäten von AD-DCs wurden teilweise auf experimenteller Basis
implementiert. Bitte erwarten Sie nicht, daß Samba-3 diese Protokolle unterstützt.
Verlassen Sie nicht auf irgendeine derartige Funktionalität, weder jetzt noch in der Zukunft.
Das Samba-Team könnte diese experimentellen Features entfernen oder deren Verhalten verändern.
Dies wird erwähnt, um jenen zu helfen, die "geheime" Fähigkeiten von Samba-3 entdeckt haben und
danach gefragt haben, wann diese Funktionalitäten vervollständigt sein werden.
Die Antwort darauf ist: "Vielleicht. Vielleicht nie!"
</para>

<para>
Um sicher zu sein, Samba-3 wurde entworfen, um den größten Teil der Funktionalität zur Verfügung zu
stellen, die MS Windows NT4-artige Domänen-Controller anbieten. Samba-3 hat nicht alle Fähigkeiten von
Windows NT4, aber es hat einige Eigenschaften, die Windows NT4-DCs nicht haben. 
Kurz gesagt, Samba-3 ist nicht NT4, Samba-3 ist nicht Windows Server 200x, Samba-3 ist kein AD-Server.
Wir hoffen, daß dies kurz und einfach genug ist, um für alle verständlich zu sein.
</para>

</sect1>

<sect1>
<title>Konfiguration von Domänen- und Netzwerk-Anmeldung</title>

<para>
Das Thema der Domänen- oder Netzwerk-Anmeldungen wird hier diskutiert, weil es einen integralen Teil
der essentiellen Funktionen eines Domänen-Controllers darstellt.
</para>

<sect2>
<title>Domänen-Netzwerks-Anmelde-Dienst</title>

<para>
Alle Domänen-Controller müssen den netlogon-Dienst ausführen (<emphasis>domain logons</emphasis> in Samba).
Ein Domänen-Controller muß mit <smbconfoption><name>domain master</name><value>Yes</value></smbconfoption>
konfiguriert werden (der PDC); auf allen BDCs muß <smbconfoption><name>domain master</name><value>No</value></smbconfoption> gesetzt werden.
</para>

<sect3>
<title>Beispiel einer Konfiguration</title>

<smbconfexample id="PDC-config">
<title>smb.conf for being a PDC</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
<smbconfoption><name>domain master</name><value>(Yes on PDC, No on BDCs)</value></smbconfoption>

<smbconfsection>[netlogon]</smbconfsection>
<smbconfoption><name>comment</name><value>Network Logon Service</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/lib/samba/netlogon</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>
</smbconfexample>

</sect3>
<sect3>
<title>Der spezielle Fall von MS Windows XP Home Edition</title>

<para>
Um es unmißverständlich auszudrücken:
Wenn Sie MS Windows XP Home Edition in ihre MS Windows NT4- oder ADS-Domäne integrieren wollen,
müssen Sie verstehen, daß dies NICHT MÖGLICH ist. Die einzige Möglichkeit ist der Erwerb eines
Upgrades von MS Windows XP Home Edition auf MS Windows XP Professional.
</para>

<note><para>
MS Windows XP Home Edition hat keine Fähigkeiten, sich jeglicher Art von Domäne anzuschliessen.
Im Unterschied zu MS Windows 9x/Me fehlt MS Windows XP Home Edition auch völlig die Fähigkeit,
sich an einem Netz anzumelden.
</para></note>

<para>
Nun, da dies ausgesprochen wurde, fragen Sie bitte NICHT auf der Samba-Mailing-Liste oder
mailen Sie auch NICHT an die Mitglieder des Samba-Teams, um zu erfragen, wie dies machbar wäre.
Es ist NICHT MÖGLICH. Wenn es möglich ist, dann würde es Ihr Software-Lizenz-Abkommen mit Microsoft
verletzen, und wir empfehlen, dies NICHT zu tun.
</para>

</sect3>

<sect3>
<title>Der spezielle Fall von Windows 9x/Me</title>

<para>
Eine Domäne und eine Arbeitsgruppe sind in den Begriffen des Netzwerk-Suchdienstes
exakt dasselbe. Der Unterschied ist, daß mit einer Domäne eine verteilbare
Anmelde-Datenbank verknüpft ist, für sichere Anmeldungen an einem Netzwerk.
Weiters können andere Zugriffs-Berechtigungen an Benutzer vergeben werden, wenn
sie sich erfolgreich an einem Domänen-Anmeldungs-Server anmelden.
Samba-3 tut dies nun in derselben Weise wie MS Windows NT/200x.
</para>

<para>
Der SMB-Client, der sich an einer Domäne anmeldet, hat die Erwartung, daß jeder
beliebige Server in der Domäne dieselbe Anmelde-Information akzeptieren sollte.
Die Netzwerk-Such-Funktionalität von Domänen und Arbeitsgruppen ist identisch und
wird in dieser Dokumentation unter den Diskussionen zum Browsing erklärt.
Es sollte bemerkt werden, daß Browsing sich völlig orthogonal zur Unterstützung
von Anmeldungen verhält.
</para>

<para>
Themen in Bezug auf das Single-Logon-Netzwerk-Modell werden in diesem Abschnitt
behandelt. Samba unterstützt Domänen-Anmeldungen, Netzwerk-Anmelde-Skripts und
Benutzerprofile für MS Windows for Workgroups und MS Windows 9X/ME Clients, die
im Mittelpunkt dieses Abschnitts stehen.
</para>

---sgw.workmark

<para>
Wenn ein SMB-Client sich in einer Domäne anmelden will, sendet er Anfragen nach einem
Anmelde-Server aus. Der erste, der antwortet, bekommt den Job, und überprüft das 
Passwort unter Verwendung jenes Mechanismus, den der Samba-Administrator installiert hat.
Es ist möglich (aber nicht empfohlen), eine Domäne anzulegen, in der die Benutzerdatenbank
nicht von den Servern geteilt wird, d.h., sie sind effektiv Arbeitsgruppen-Server, die sich
als Teilnehmer an einer Domäne bewerben. Dies demonstriert, wie Authentifikation einerseits
sehr unterschiedlich von Domänen ist, andererseits aber eng mit ihnen verknüpft ist.
</para>

<para>
Unter Verwendung dieser Eigenschaften können Sie Ihre Clients ihre Anmeldung via
Samba-Server überprüfen lassen, sie dazu veranlassen, bei der Netzwerkanmeldung
ein Skript auszuführen und ihre Einstellungen, Desktops und Startmenüs herunterzuladen.
</para>

<para><emphasis>
MS Windows XP Home edition ist nicht fähig, sich einer Domäne anzuschliessen, und
erlaubt keine Verwendung von Domänenanmeldungen.
</emphasis></para>

<para>
Bevor wir mit den Konfigurations-Anleitungen beginnen, lohnt es sich, sich anzusehen,
wie ein Windows 9x/Me-Client eine Anmeldung durchführt:
</para>

<orderedlist>
<listitem>
	<para>
	Der Client versendet mittels Broadcasts (an die IP-broadcast-Adresse des
	Subnetzes, in dem er sich befindet) eine NetLogon-Anfrage. Diese wird an den 
	NetBIOS-Namen DOMÄNE&lt;#1c&gt; auf dem NetBIOS-Layer gesandt. Der Client
	wählt die erste Antwort, die er erhält, welche den NetBIOS-Namen des 
	zu verwendenden Anmeldeservers im Format <filename>\\SERVER</filename> enthält.
	</para>
</listitem>

<listitem>
	<para>
	Der Client verbindet sich mit diesem Server, meldet sich an (führt ein SMBsessetupX aus)
	und verbindet sich dann mit der IPC$-Freigabe (unter Verwendung eines SMBtconX).
	</para>
</listitem>

<listitem>
	<para>
	Der Client führt eine Anfrage vom Typ NetWkstaUserLogon aus, welche den Namen des
	Anmeldeskripts des Benutzers zurückgibt.	
	</para>
</listitem>

<listitem>
	<para>
	Der Client verbindet sich dann mit der Netlogon-Freigabe und sucht nach dem angegebenen
	Skript. Wenn es gefunden wird und gelesen werden kann, wird es geladen und vom Client
	ausgeführt. Danach trennt der Client die Verbindung mit der Netlogon-Freigabe.
	</para>
</listitem>

<listitem>
	<para>
	Der Client sendet eine Anfrage vom Typ NetUserGetInfo an den Server, um die Home-Freigabe
	des Benutzers zu erhalten, welche dazu benutzt wird, um nach Profilen zu suchen. Da die
	Antwort auf die NetUserGetInfo-Anfrage nicht viel mehr enthält als die Home-Freigabe des
	Benutzers, müssen Profile für Windows 9x clients im Home-Verzeichnis des Benutzers liegen.
	</para>
</listitem>

<listitem>
	<para>
	Der Client verbindet sich mit der Home-Freigabe des Benutzers und sucht nach dem Benutzerprofil.
	Wie sich herausstellt, können Sie die Home-Freigabe als Freigabe und Pfas angeben.
	Zum Beispiel, <filename>\\server\fred\.winprofile</filename>.
	Wenn die Profile gefunden werden, werden sie eingebunden.
	</para>
</listitem>

<listitem>
	<para>
	Der Client trennt die Verbindung mit der Home-Freigabe des Benutzers und verbindet sich wieder
	mit der Netlogon-Freigabe und sucht nach <filename>CONFIG.POL</filename>, der Policies-Datei.
	Wenn diese gefunden wird, wird sie gelesen und eingebunden.	
	</para>
</listitem>
</orderedlist>

<para>
The main difference between a PDC and a Windows 9x/Me logon server configuration is:
</para>

<itemizedlist>
<listitem><para>
	Password encryption is not required for a Windows 9x/Me logon server. But note
	that beginning with MS Windows 98 the default setting is that plain-text
	password support is disabled. It can be re-enabled with the registry
	changes that are documented in <link linkend="PolicyMgmt"/>.
	</para></listitem>

	<listitem><para>
	Windows 9x/Me clients do not require and do not use Machine Trust Accounts.
	</para></listitem>
</itemizedlist>

<para>
A Samba PDC will act as a Windows 9x/Me logon server; after all, it does provide the
network logon services that MS Windows 9x/Me expect to find.
</para>

<note><para>
Use of plain-text passwords is strongly discouraged. Where used they are easily detected
using a sniffer tool to examine network traffic.
</para></note>

</sect3>
</sect2>

<sect2>
<title>Security Mode and Master Browsers</title>

<para>
There are a few comments to make in order to tie up some loose ends. There has been
much debate over the issue of whether it is okay to configure Samba as a Domain
Controller in security modes other than user. The only security mode that will
not work due to technical reasons is share-mode security. Domain and server mode
security are really just a variation on SMB User Level Security.
</para>

<para>
Actually, this issue is also closely tied to the debate on whether
Samba must be the Domain Master Browser for its workgroup
when operating as a DC. While it may technically be possible
to configure a server as such (after all, browsing and domain logons
are two distinctly different functions), it is not a good idea to do
so. You should remember that the DC must register the DOMAIN&lt;#1b&gt; NetBIOS
name. This is the name used by Windows clients to locate the DC.
Windows clients do not distinguish between the DC and the DMB.
A DMB is a Domain Master Browser &smbmdash; see <link linkend="DMB"></link>.
For this reason, it is wise to configure the Samba DC as the DMB.
</para>

<para>
Now back to the issue of configuring a Samba DC to use a mode other than
<smbconfoption><name>security</name><value>user</value></smbconfoption>. If a Samba host is
configured to use another SMB server or DC in order to validate user connection requests,
it is a fact that some other machine on the network (the <smbconfoption><name>password server</name></smbconfoption>)
knows more about the user than the Samba host. About 99% of the time, this other host is
a Domain Controller. Now to operate in domain mode security, the <smbconfoption><name>workgroup</name></smbconfoption>
parameter must be set to the name of the Windows NT domain (which already has a Domain Controller).
If the domain does not already have a Domain Controller, you do not yet have a Domain.
</para>

<para>
Configuring a Samba box as a DC for a domain that already by definition has a
PDC is asking for trouble. Therefore, you should always configure the Samba DC
to be the DMB for its domain and set <smbconfoption><name>security</name><value>user</value></smbconfoption>.
This is the only officially supported mode of operation.
</para>

</sect2>

</sect1>

<sect1>
<title>Common Errors</title>

<sect2>
	<title><quote>$</quote> Cannot Be Included in Machine Name</title>
<para>
A machine account, typically stored in <filename>/etc/passwd</filename>, takes the form of the machine
name with a <quote>$</quote> appended. FreeBSD (and other BSD systems) will not create a user with a
<quote>$</quote> in the name.
</para>

<para>
The problem is only in the program used to make the entry. Once made, it works perfectly.
Create a user without the <quote>$</quote>. Then use <command>vipw</command> to edit the entry, adding
the <quote>$</quote>. Or create the whole entry with vipw if you like; make sure you use a unique user login ID.
</para>

<para><note>The machine account must have the exact name that the workstation has.</note></para>

<note><para>
The UNIX tool <command>vipw</command> is a common tool for directly editing the <filename>/etc/passwd</filename> file.
</para></note>

</sect2>

<sect2>
<title>Joining Domain Fails Because of Existing Machine Account</title>

<para>
<quote>I get told, `You already have a connection to the Domain....' or `Cannot join domain, the
credentials supplied conflict with an existing set...' when creating a Machine Trust Account.</quote>
</para>

<para>
This happens if you try to create a Machine Trust Account from the machine itself and already have a
connection (e.g., mapped drive) to a share (or IPC$) on the Samba PDC. The following command
will remove all network drive connections:
<screen>
&dosprompt;<userinput>net use * /d</userinput>
</screen>
</para>

<para>
Further, if the machine is already a <quote>member of a workgroup</quote> that
is the same name as the domain you are joining (bad idea) you will
get this message. Change the workgroup name to something else, it
does not matter what, reboot, and try again.
</para>
</sect2>

<sect2>
<title>The System Cannot Log You On (C000019B)</title>

<para><quote>I joined the domain successfully but after upgrading
to a newer version of the Samba code I get the message, <errorname>`The system
cannot log you on (C000019B), Please try again or consult your
system administrator</errorname> when attempting to logon.'</quote>
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
This occurs when the domain SID stored in the secrets.tdb database
is changed. The most common cause of a change in domain SID is when
the domain name and/or the server name (NetBIOS name) is changed.
The only way to correct the problem is to restore the original domain
SID or remove the domain client from the domain and rejoin. The domain
SID may be reset using either the net or rpcclient utilities.
</para>

<para>
To reset or change the domain SID you can use the net command as follows:

<screen>
&rootprompt;<userinput>net getlocalsid 'OLDNAME'</userinput>
&rootprompt;<userinput>net setlocalsid 'SID'</userinput>
</screen>
</para>

<para>
Workstation Machine Trust Accounts work only with the Domain (or network) SID. If this SID changes
Domain Members (workstations) will not be able to log onto the domain. The original Domain SID
can be recovered from the secrets.tdb file. The alternative is to visit each workstation to re-join
it to the domain.
</para>

</sect2>

<sect2>
<title>The Machine Trust Account Is Not Accessible</title>

<para>
<quote>When I try to join the domain I get the message, <errorname>`The machine account
for this computer either does not exist or is not accessible'</errorname>. What's
wrong?</quote>
</para>

<para>
This problem is caused by the PDC not having a suitable Machine Trust Account.
If you are using the <smbconfoption><name>add machine script</name></smbconfoption> method to create
accounts then this would indicate that it has not worked. Ensure the domain
admin user system is working.
</para>

<para>
Alternately, if you are creating account entries manually then they
have not been created correctly. Make sure that you have the entry
correct for the Machine Trust Account in <filename>smbpasswd</filename> file on the Samba PDC.
If you added the account using an editor rather than using the smbpasswd
utility, make sure that the account name is the machine NetBIOS name
with a <quote>$</quote> appended to it (i.e., computer_name$). There must be an entry
in both /etc/passwd and the smbpasswd file.
</para>

<para>
Some people have also reported that inconsistent subnet masks between the Samba server and the NT
client can cause this problem.  Make sure that these are consistent for both client and server.
</para>
</sect2>

<sect2>
<title>Account Disabled</title>

<para><quote>When I attempt to login to a Samba Domain from a NT4/W200x workstation,
I get a message about my account being disabled.</quote></para>

<para>
Enable the user accounts with <userinput>smbpasswd -e <replaceable>username</replaceable>
</userinput>. This is normally done as an account is created.
</para>

</sect2>

<sect2>
<title>Domain Controller Unavailable</title>

<para><quote>Until a few minutes after Samba has started, clients get the error `Domain Controller Unavailable'</quote></para>

<para>
A Domain Controller has to announce its role on the network. This usually takes a while. Be patient for up to fifteen minutes,
then try again.
</para>
</sect2>

<sect2>
<title>Cannot Log onto Domain Member Workstation After Joining Domain</title>

<para>
<indexterm><primary>schannel</primary></indexterm>
<indexterm><primary>signing</primary></indexterm>
After successfully joining the domain, user logons fail with one of two messages: one to the
effect that the Domain Controller cannot be found; the other claims that the account does not
exist in the domain or that the password is incorrect. This may be due to incompatible
settings between the Windows client and the Samba-3 server for <emphasis>schannel</emphasis>
(secure channel) settings or <emphasis>smb signing</emphasis> settings. Check your Samba
settings for <emphasis> client schannel, server schannel, client signing, server signing</emphasis>
by executing:
<screen>
<command>testparm -v | more</command> and looking for the value of these parameters.
</screen>
</para>

<para>
Also use the Microsoft Management Console &smbmdash; Local Security Settings. This tool is available from the
Control Panel. The Policy settings are found in the Local Policies/Securty Options area and are prefixed by
<emphasis>Secure Channel: ..., and Digitally sign ....</emphasis>.
</para>

<para>
It is important that these be set consistently with the Samba-3 server settings.
</para>

</sect2>

</sect1>
</chapter>
