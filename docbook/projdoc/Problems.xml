<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="problems">

<chapterinfo>
	&author.jerry;
	&author.jelmer;
	&author.dbannon;
	&author.danshearer;
	<pubdate>8 Apr 2003</pubdate>
        <author>&person.sgw;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Analyse und Lösung von Problemen mit Samba</title>

<para>
Es gibt viele Informationsquellen in Form von Mailing-Listen, RFCs und Dokumentation.
Die Dokumentation, die mit der Samba-Distribution geliefert wird, enthält gute
Erklärungen zu allgemeinen Samba-Themen wie Browsing.</para>
	
<sect1>
<title>Diagnose-Tools</title>

<para>
Beim Netzwerken mit Samba ist es oft nicht sofort klar, was der Grund für ein bestimmtes
Problem ist. Samba selbst bietet ziemlich hilfreiche Informationen an, aber in manchen
Fällen werden Sie möglicherweise auf einen <emphasis>Sniffer</emphasis> zurückgreifen
müssen. Ein Sniffer ist ein Programm, das in Ihrem LAN lauscht, die empfangenen Daten
analysiert, und sie am Schirm anzeigt.
</para>

<sect2>
<title>Das Debuggen mit Samba selbst</title>

<para>
Eines der besten Diagnose-Tools, um Probleme zu debuggen, ist Samba selbst.
Sie können die Option <option>-d</option> für &smbd; und &nmbd; verwenden, um
den <smbconfoption><name>debug level</name></smbconfoption> festzulegen, auf dem sie
ausgeführt werden sollen. Siehe auch die manpages für <command>smbd, nmbd</command>
und &smb.conf; für mehr Information zu den debugging-Optionen. Der debug level
reicht von 1 (Standard) bis zu 10 (100 zum Debuggen von Passwörtern).
</para>
	
<para>
Eine weitere hilfreiche Methode des Debugging ist es, Samba mit dem Flag
<command>gcc -g </command> zu kompilieren. Dies wird Debug-Information in den Binaries
einschliessen, und erlaubt es, gdb an die laufenden <command>smbd/nmbd</command>-Prozesse
anzudocken. Um dies auf einer NT-Workstation zu tun, lassen Sie zuerst die Workstation
die Verbindung herstellen. Das Drücken von ctrl-alt-delete und Gehen auf den Domänen-Eintrag
sollte ausreichen (zumindest beim ersten Anmelden an der Domäne), um den Parameter
<parameter>LsaEnumTrustedDomains</parameter> zu generieren. Danach hält die Workstation
eine offene Verbindung und es wird ein smbd-Prozess laufen (unter der Annahme, daß Sie
keinen wirklich kurzen smbd-Timeout gesetzt haben). Also können Sie zwischen dem Drücken
von <command>ctrl-alt-delete</command> und dem tatsächlichen Eingeben Ihres Passworts
<command>gdb</command> starten und fortsetzen.
</para>

<para>
Einige Samba-Befehle, die nähere Betrachtung verdienen, sind:
</para>
	
<screen>
&prompt;<userinput>testparm | more</userinput>
&prompt;<userinput>smbclient -L //{Netbios-Name des Servers}</userinput>
</screen>

</sect2>

<sect2>
	<title>Tcpdump</title>
  
<para>
<ulink url="http://www.tcpdump.org/">Tcpdump</ulink> war der erste
UNIX sniffer mit SMB-Support. Es ist ein Befehlszeilen-Tool, und mittlerweile hängt seine
SMB-Unterstützung etwas hinter der von <command>ethereal</command> und <command>tethereal</command>
nach.
</para>

</sect2>

<sect2>
	<title>Ethereal</title>

<para>
<ulink url="http://www.ethereal.com/">Ethereal</ulink> ist ein grafischer Sniffer, verfügbar sowohl
für UNIX (Gtk) und Windows. Ethereal's SMB-Unterstützung ist ziemlich gut.
Für Details zu <command>ethereal</command>, lesen Sie den gutgeschriebenen Ethereal User Guide.
</para>

<image id="ethereal1"><imagefile>ethereal1</imagefile><imagedescription>Start eines Capture.</imagedescription></image>

<para>
Überwachen der Daten auf den Ports 137, 138, 139, und 445. Zum Beispiel, verwenden Sie den Filter
<userinput>port 137, port 138, port 139, oder port 445</userinput>, wie in <link linkend="ethereal1"/>
zu sehen.
</para>

<para>
Eine Consolen-Version von ethereal ist auch verfügbar, namens <command>tethereal</command>.</para>

<image id="ethereal2"><imagefile>ethereal2</imagefile><imagedescription>Hauptansicht von ethereal.</imagedescription></image>

</sect2>

<sect2>
<title>Der Windows Netzwerk-Monitor.</title>
	
<para>
Um Dinge unter Microsoft Windows NT zu verfolgen, ist der Netzwerk-Monitor (auch bekannt als Netmon)
auf den Microsoft Developer Network CDs verfügbar, sowie auf der Installations-CD des Windows NT Servers,
und auf den SMS CDs. Die mit SMS gelieferte Version erlaubt es, Pakete zwischen zwei Rechnern zu dumpen
(die Netzwerkkarte im promiscuous mode zu betreiben). Die Version auf der Windows-NT-Server-CD erlaubt
nur das Monitoring von Netzwerkverkehr zur lokalen NT-Box, und Broadcasts im lokalen Subnetz. Beachten Sie,
daß Ethereal Dateien im Netmon-Format lesen und schreiben kann.
</para>

<sect3>
<title>Installieren des Netzwerk-Monitors auf einer NT-Workstation</title>

<para>
Das Installieren von Netmon auf einer NT-Workstation erfordert einige Schritte.
Die folgenden Anweisungen gelten für die Installation von Netmon V4.00.349, welcher mit dem
Microsoft Windows NT Server 4.0 geliefert wird, auf Microsoft Windows NT Workstation 4.0.
Der Ablauf sollte für andere Versionen von Netmon für Windows NT sein. Sie werden sowohl die
NT Server 4.0 Installations-CD, wie auch die Workstation 4.0 Installations-CD dazu brauchen.
</para> 

<para>
Zuerst müssen Sie <application>Network Monitor Tools and Agent</application> auf dem NT-Server
installieren:
</para>

<itemizedlist>
	<listitem><para>Gehen Sie auf <guibutton>Start</guibutton> -> <guibutton>Settings</guibutton> -> <guibutton>Control Panel</guibutton> -> 
	<guibutton>Network</guibutton> -> <guibutton>Services</guibutton> -> <guibutton>Add</guibutton>.</para></listitem>
	
	<listitem><para>Wählen Sie <guilabel>Network Monitor Tools and Agent</guilabel> und klicken Sie auf <guibutton>OK</guibutton>.</para></listitem> 
	
	<listitem><para>Klicken Sie auf <guibutton>OK</guibutton> im Network Control Panel.</para></listitem> 
	
	<listitem><para>Legen Sie die NT Server 4.0 Installations-CD ein, wenn Sie dazu aufgefordert werden.</para></listitem> 
</itemizedlist>

<para>
An diesem Punkt sollten die Netmon files in <filename>%SYSTEMROOT%\System32\netmon\*.*</filename> existieren.
Es gibt auch zwei Unterverzeichnisse, <filename>parsers\</filename>, welches die notwendigen DLLs enthält, um
den Netmon-Paket-dump zu parsen, und <filename>captures\</filename>.
</para>

<para>
Um die Netmon-tools auf einer NT Workstation zu installieren, müssen Sie zuerst den Network Monitor Agent von
der Workstation 4.0 Installations-CD installieren.
</para>

<itemizedlist>
	<listitem><para>Go to <guibutton>Start</guibutton> -> <guibutton>Settings</guibutton> -> <guibutton>Control Panel</guibutton> -> 
			<guibutton>Network</guibutton> -> <guibutton>Services</guibutton> -> <guibutton>Add</guibutton>.</para></listitem> 

	<listitem><para>Select the <guilabel>Network Monitor Agent</guilabel>, click on <guibutton>OK</guibutton>.</para></listitem> 
	
	<listitem><para>Click on <guibutton>OK</guibutton> in the Network Control Panel.
	</para></listitem> 
	
	<listitem><para>Insert the Windows NT Workstation 4.0 install CD when prompted.</para></listitem> 
</itemizedlist>

<para>
Now copy the files from the NT Server in <filename>%SYSTEMROOT%\System32\netmon</filename>
to <filename>%SYSTEMROOT%\System32\netmon</filename> on the Workstation and set permissions
as you deem appropriate for your site. You will need administrative rights on the NT box to run Netmon.
</para>

</sect3>
<sect3>
<title>Installing Network Monitor on Windows 9x/Me</title>
<para>
To install Netmon on Windows 9x/Me, install the Network Monitor Agent 
from the Windows 9x/Me CD (<filename>\admin\nettools\netmon</filename>). 
There is a readme file located with the Netmon driver files on the CD if you need 
information on how to do this. Copy the files from a working Netmon installation.
</para>
</sect3>
</sect2>
</sect1>

<sect1>
<title>Useful URLs</title>
<itemizedlist>

<listitem><para>See how Scott Merrill simulates a BDC behavior at 
       <ulink noescape="1" url="http://www.skippy.net/linux/smb-howto.html">
       http://www.skippy.net/linux/smb-howto.html</ulink>. </para></listitem>

<listitem><para>FTP site for older SMB specs: 
       <ulink noescape="1" url="ftp://ftp.microsoft.com/developr/drg/CIFS/">
       ftp://ftp.microsoft.com/developr/drg/CIFS/</ulink></para></listitem>

</itemizedlist>

</sect1>

<sect1>
<title>Getting Mailing List Help</title>

<para>
There are a number of Samba-related mailing lists. Go to <ulink 
noescape="1" url="http://samba.org">http://samba.org</ulink>, click on your nearest mirror
and then click on <command>Support</command> and next click on <command>
Samba-related mailing lists</command>.
</para>

<para>
For questions relating to Samba TNG, go to
<ulink noescape="1" url="http://www.samba-tng.org/">http://www.samba-tng.org/.</ulink> 
It has been requested that you do not post questions about Samba-TNG to the
main-stream Samba lists.</para>

<para>
If you do post a message to one of the lists, please observe the following guidelines :
</para>

<itemizedlist>

	<listitem><para>Always remember that the developers are volunteers, they are
	not paid and they never guarantee to produce a particular feature at 
	a particular time. Any timelines are <quote>best guess</quote> and nothing more.
	</para></listitem>

	<listitem><para>Always mention what version of Samba you are using and what 
	operating system it's running under. You should list the relevant sections of
	your &smb.conf; file, at least the options in <smbconfsection>[global]</smbconfsection>
	that affect PDC support.
	</para></listitem>

	<listitem><para>In addition to the version, if you obtained Samba via
	CVS, mention the date when you last checked it out.</para></listitem>

	<listitem><para> Try and make your questions clear and brief. Lots of long, 
	convoluted questions get deleted before	they are completely read!
	Do not post HTML encoded messages. Most people on mailing lists simply delete
	them.
	</para></listitem>

	<listitem><para> If you run one of those nifty <quote>I'm on holidays</quote> things when
	you are away, make sure its configured to not answer mailing list traffic. Auto-responses
	to mailing lists really irritate the thousands of people who end up having to deal
	with such bad netiquet bahavior.
	</para></listitem> 

	<listitem><para>Don't cross post. Work out which is the best list to post to 
	and see what happens. Do not post to both samba-ntdom and samba-technical.
	Many people active on the lists subscribe to more 
	than one list and get annoyed to see the same message two or more times.
	Often someone will see a message and thinking it would be better dealt 
	with on another list, will forward it on for you.</para></listitem>

	<listitem><para>You might include <emphasis>partial</emphasis>
	log files written at a debug level set to as much as 20. 
	Please do not send the entire log but just enough to give the context of the
	error messages.</para></listitem>

	<listitem><para>If you have a complete Netmon trace (from the opening of
	the pipe to the error), you can send the *.CAP file as well.</para></listitem> 
	    `
	<listitem><para>Please think carefully before attaching a document to an email.
	Consider pasting the relevant parts into the body of the message. The Samba
	mailing lists go to a huge number of people. Do they all need a copy of your 
	&smb.conf; in their attach directory?</para></listitem>

</itemizedlist>

</sect1>

<sect1>
<title>How to Get Off the Mailing Lists</title>

<para>To have your name removed from a Samba mailing list, go to the same
place where you went to
subscribe to it. Go to <ulink noescape="1" url="http://lists.samba.org/">http://lists.samba.org</ulink>, 
click on your nearest mirror, click on <command>Support</command> and 
then click on<command> Samba related mailing lists</command>. 
</para>

<para>
Please do not post messages to the list asking to be removed. You will only
be referred to the above address (unless that process failed in some way).
</para>

</sect1>

</chapter>
